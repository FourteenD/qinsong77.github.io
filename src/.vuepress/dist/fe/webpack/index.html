<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileColor" content="#333"><link rel="apple-touch-icon" href="/icons/128.ico"><title>Summary | Sysuke' NoteBook</title><meta name="description" content="personal frontend noteBook power by VuePress & GitHub Page">
    <link rel="modulepreload" href="/assets/app.552fc8bd.js"><link rel="modulepreload" href="/assets/index.html.f492466b.js"><link rel="modulepreload" href="/assets/index.html.434a492f.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.d0e46110.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/icons/128.ico" alt="Sysuke&#39; NoteBook"><span class="site-name can-hide">Sysuke&#39; NoteBook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/fe/js" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/dom" class="" aria-label="Dom"><!--[--><!--]--> Dom <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/fe/webpack" class="router-link-active router-link-exact-active router-link-active" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/frameWork" class="" aria-label="frameWork"><!--[--><!--]--> frameWork <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/binaryTree" class="" aria-label="二叉树"><!--[--><!--]--> 二叉树 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/sort" class="" aria-label="排序算法"><!--[--><!--]--> 排序算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/dynamic" class="" aria-label="动态规划"><!--[--><!--]--> 动态规划 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/backTrack" class="" aria-label="回溯算法"><!--[--><!--]--> 回溯算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/interview" class="" aria-label="面试记录"><!--[--><!--]--> 面试记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/backEnd/node" class="" aria-label="后端"><!--[--><!--]--> 后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/interview/" class="" aria-label="面试"><!--[--><!--]--> 面试 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/demo" class="" aria-label="Demo"><!--[--><!--]--> Demo <!--[--><!--]--></a></div><div class="navbar-item"><a href="/resume" class="" aria-label="Resume"><!--[--><!--]--> Resume <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/qinsong77" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/qinsong77/qinsong77.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/fe/js" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/dom" class="" aria-label="Dom"><!--[--><!--]--> Dom <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/fe/webpack" class="router-link-active router-link-exact-active router-link-active" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fe/frameWork" class="" aria-label="frameWork"><!--[--><!--]--> frameWork <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/binaryTree" class="" aria-label="二叉树"><!--[--><!--]--> 二叉树 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/sort" class="" aria-label="排序算法"><!--[--><!--]--> 排序算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/dynamic" class="" aria-label="动态规划"><!--[--><!--]--> 动态规划 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/backTrack" class="" aria-label="回溯算法"><!--[--><!--]--> 回溯算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/interview" class="" aria-label="面试记录"><!--[--><!--]--> 面试记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/backEnd/node" class="" aria-label="后端"><!--[--><!--]--> 后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/interview/" class="" aria-label="面试"><!--[--><!--]--> 面试 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/demo" class="" aria-label="Demo"><!--[--><!--]--> Demo <!--[--><!--]--></a></div><div class="navbar-item"><a href="/resume" class="" aria-label="Resume"><!--[--><!--]--> Resume <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/qinsong77" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/qinsong77/qinsong77.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">JavaScript <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/fe/js/" class="sidebar-item" aria-label="LearnAndNoteList"><!--[--><!--]--> LearnAndNoteList <!--[--><!--]--></a><!----></li><li><a href="/fe/js/learn.html" class="sidebar-item" aria-label="学习笔记"><!--[--><!--]--> 学习笔记 <!--[--><!--]--></a><!----></li><li><a href="/fe/js/achieve.html" class="sidebar-item" aria-label="手写实现"><!--[--><!--]--> 手写实现 <!--[--><!--]--></a><!----></li><li><a href="/fe/js/prototype.html" class="sidebar-item" aria-label="原型、原型链、继承"><!--[--><!--]--> 原型、原型链、继承 <!--[--><!--]--></a><!----></li><li><a href="/fe/js/extend.html" class="sidebar-item" aria-label="继承"><!--[--><!--]--> 继承 <!--[--><!--]--></a><!----></li><li><a href="/fe/js/var_type.html" class="sidebar-item" aria-label="变量和类型"><!--[--><!--]--> 变量和类型 <!--[--><!--]--></a><!----></li><li><a href="/fe/js/type_conversion.html" class="sidebar-item" aria-label="类型转换"><!--[--><!--]--> 类型转换 <!--[--><!--]--></a><!----></li><li><a href="/fe/js/context_execution_stack_this.html" class="sidebar-item" aria-label="执行上下文、执行栈、this"><!--[--><!--]--> 执行上下文、执行栈、this <!--[--><!--]--></a><!----></li><li><a href="/fe/js/event_loop.html" class="sidebar-item" aria-label="事件循环"><!--[--><!--]--> 事件循环 <!--[--><!--]--></a><!----></li><li><a href="/fe/js/alwaysNote.html" class="sidebar-item" aria-label="常用笔记"><!--[--><!--]--> 常用笔记 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Vue <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/fe/vue/" class="sidebar-item" aria-label="原理"><!--[--><!--]--> 原理 <!--[--><!--]--></a><!----></li><li><a href="/fe/vue/vuex.html" class="sidebar-item" aria-label="Vuex"><!--[--><!--]--> Vuex <!--[--><!--]--></a><!----></li><li><a href="/fe/vue/alwaysNote.html" class="sidebar-item" aria-label="常用笔记vue"><!--[--><!--]--> 常用笔记vue <!--[--><!--]--></a><!----></li><li><a href="/fe/vue/vue3.html" class="sidebar-item" aria-label="Vue 3.0"><!--[--><!--]--> Vue 3.0 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">React <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/fe/react" class="sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><li><a href="/fe/react/react_hooks.html" class="sidebar-item" aria-label="React Hooks"><!--[--><!--]--> React Hooks <!--[--><!--]--></a><!----></li><li><a href="/fe/react/react_around.html" class="sidebar-item" aria-label="React Around"><!--[--><!--]--> React Around <!--[--><!--]--></a><!----></li><li><a href="/fe/react/react_native.html" class="sidebar-item" aria-label="React Native"><!--[--><!--]--> React Native <!--[--><!--]--></a><!----></li><li><a href="/fe/react/typescript.html" class="sidebar-item" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a><!----></li><li><a href="/fe/react/build_mini_react.html" class="sidebar-item" aria-label="构建你自己的 React 框架"><!--[--><!--]--> 构建你自己的 React 框架 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">CSS <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/fe/css" class="sidebar-item" aria-label="Summary"><!--[--><!--]--> Summary <!--[--><!--]--></a><!----></li><li><a href="/fe/css/BFC.html" class="sidebar-item" aria-label="BFC、IFC和清除浮动"><!--[--><!--]--> BFC、IFC和清除浮动 <!--[--><!--]--></a><!----></li><li><a href="/fe/css/flex_grid.html" class="sidebar-item" aria-label="flex和grid"><!--[--><!--]--> flex和grid <!--[--><!--]--></a><!----></li><li><a href="/fe/css/onepx.html" class="sidebar-item" aria-label="1px及相关概念"><!--[--><!--]--> 1px及相关概念 <!--[--><!--]--></a><!----></li><li><a href="/fe/css/demo.html" class="sidebar-item" aria-label="demo"><!--[--><!--]--> demo <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Dom <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/fe/dom" class="sidebar-item" aria-label="Summary"><!--[--><!--]--> Summary <!--[--><!--]--></a><!----></li><li><a href="/fe/dom/safety.html" class="sidebar-item" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a><!----></li><li><a href="/fe/dom/canvas.html" class="sidebar-item" aria-label="canvas"><!--[--><!--]--> canvas <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">webpack <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/fe/webpack" class="router-link-active router-link-exact-active router-link-active sidebar-item" aria-label="Summary"><!--[--><!--]--> Summary <!--[--><!--]--></a><!----></li><li><a href="/fe/webpack/webpack5.html" class="sidebar-item" aria-label="Webpack5"><!--[--><!--]--> Webpack5 <!--[--><!--]--></a><!----></li><li><a href="/fe/webpack/buildAndModuleFederation.html" class="sidebar-item" aria-label="打包原理和Module federation"><!--[--><!--]--> 打包原理和Module federation <!--[--><!--]--></a><!----></li><li><a href="/fe/webpack/vite2.html" class="sidebar-item" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">frameWork <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/fe/frameWork" class="sidebar-item" aria-label="框架汇总"><!--[--><!--]--> 框架汇总 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/microservices.html" class="sidebar-item" aria-label="微前端"><!--[--><!--]--> 微前端 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/mobile.html" class="sidebar-item" aria-label="移动端"><!--[--><!--]--> 移动端 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/miniprogram.html" class="sidebar-item" aria-label="小程序"><!--[--><!--]--> 小程序 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/ssr.html" class="sidebar-item" aria-label="服务器渲染"><!--[--><!--]--> 服务器渲染 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/network.html" class="sidebar-item" aria-label="网络相关"><!--[--><!--]--> 网络相关 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/http.html" class="sidebar-item" aria-label="HTTP 协议总结"><!--[--><!--]--> HTTP 协议总结 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/https.html" class="sidebar-item" aria-label="HTTPS 协议总结"><!--[--><!--]--> HTTPS 协议总结 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/websocket.html" class="sidebar-item" aria-label="websocket"><!--[--><!--]--> websocket <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/performance.html" class="sidebar-item" aria-label="前端性能优化"><!--[--><!--]--> 前端性能优化 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/component_library_design.html" class="sidebar-item" aria-label="组件库设计"><!--[--><!--]--> 组件库设计 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/test.html" class="sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><li><a href="/fe/frameWork/thought.html" class="sidebar-item" aria-label="想法和总结"><!--[--><!--]--> 想法和总结 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><ul><li><a href="#%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96">前端工程化</a></li><li><a href="#monorepo">Monorepo</a></li><li><a href="#babel">Babel</a></li><li><a href="#postcss">postcss</a></li><li><a href="#%E7%AE%80%E8%BF%B0webpack%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">webpack工作流程</a></li><li><a href="#%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B">打包过程</a></li><li><a href="#%E5%B8%B8%E7%94%A8loader">常用loader</a></li><li><a href="#%E5%B8%B8%E7%94%A8plugin">常用plugin</a></li><li><a href="#%E7%83%AD%E6%9B%B4%E6%96%B0">热更新</a></li><li><a href="#_3%E7%A7%8Dhash">3种hash</a></li><li><a href="#code-splitting">Code Splitting</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD-%E4%BD%A0%E4%BD%BF%E7%94%A8-webpack-%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8C%96">项目中-你使用-webpack-做了哪些优化</a></li><li><a href="#%E7%BC%96%E5%86%99loader">编写loader</a></li><li><a href="#%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6">编写插件</a></li><li><a href="#tree-shaking">Tree Shaking</a></li><li><a href="#webpack%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85%E5%8E%9F%E7%90%86">Webpack模块加载打包原理</a></li><li><a href="#require-context%E6%98%AF%E4%BB%80%E4%B9%88">require.context是什么</a></li><li><a href="#sourcemap">SourceMap</a></li></ul><h2 id="文章合集" tabindex="-1"><a class="header-anchor" href="#文章合集" aria-hidden="true">#</a> 文章合集</h2><h4 id="webpack-中那些最易混淆的-5-个知识点" tabindex="-1"><a class="header-anchor" href="#webpack-中那些最易混淆的-5-个知识点" aria-hidden="true">#</a> <a href="https://juejin.cn/post/6844904007362674701" target="_blank" rel="noopener noreferrer">webpack 中那些最易混淆的 5 个知识点<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="webpack4打包机制原理解析" tabindex="-1"><a class="header-anchor" href="#webpack4打包机制原理解析" aria-hidden="true">#</a> <a href="https://mp.weixin.qq.com/s/WXUW4bS4nT90uycodN0avw" target="_blank" rel="noopener noreferrer">Webpack4打包机制原理解析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="webpack面试题" tabindex="-1"><a class="header-anchor" href="#webpack面试题" aria-hidden="true">#</a> <a href="https://juejin.cn/post/6844904094281236487" target="_blank" rel="noopener noreferrer">Webpack面试题<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="从源码窥探webpack4-x原理" tabindex="-1"><a class="header-anchor" href="#从源码窥探webpack4-x原理" aria-hidden="true">#</a> <a href="https://juejin.cn/post/6844904046294204429" target="_blank" rel="noopener noreferrer">从源码窥探Webpack4.x原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="webpack小书" tabindex="-1"><a class="header-anchor" href="#webpack小书" aria-hidden="true">#</a> <a href="https://www.timsrc.com/article/2/webpack-book" target="_blank" rel="noopener noreferrer">webpack小书<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="webpack揭秘" tabindex="-1"><a class="header-anchor" href="#webpack揭秘" aria-hidden="true">#</a> <a href="https://juejin.cn/post/6844903685407916039" target="_blank" rel="noopener noreferrer">Webpack揭秘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="由浅入深配置webpack4" tabindex="-1"><a class="header-anchor" href="#由浅入深配置webpack4" aria-hidden="true">#</a> <a href="https://juejin.im/post/6859888538004783118" target="_blank" rel="noopener noreferrer">由浅入深配置webpack4<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="手写webpack核心原理" tabindex="-1"><a class="header-anchor" href="#手写webpack核心原理" aria-hidden="true">#</a> <a href="https://juejin.im/post/6854573217336541192" target="_blank" rel="noopener noreferrer">手写webpack核心原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="体积减少80-释放webpack-tree-shaking的真正潜力" tabindex="-1"><a class="header-anchor" href="#体积减少80-释放webpack-tree-shaking的真正潜力" aria-hidden="true">#</a> <a href="https://juejin.cn/post/6844903769646317576" target="_blank" rel="noopener noreferrer">体积减少80%！释放webpack tree-shaking的真正潜力<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="vite-原理分析" tabindex="-1"><a class="header-anchor" href="#vite-原理分析" aria-hidden="true">#</a> <a href="https://juejin.cn/post/6881078539756503047" target="_blank" rel="noopener noreferrer">Vite 原理分析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="前端-dsl-实践指南" tabindex="-1"><a class="header-anchor" href="#前端-dsl-实践指南" aria-hidden="true">#</a> <a href="https://zhuanlan.zhihu.com/p/107947462" target="_blank" rel="noopener noreferrer">前端 DSL 实践指南<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h3 id="前端工程化" tabindex="-1"><a class="header-anchor" href="#前端工程化" aria-hidden="true">#</a> 前端工程化</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/276458191" target="_blank" rel="noopener noreferrer">手把手带你入门前端工程化——超详细教程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://juejin.cn/post/6844904132512317453" target="_blank" rel="noopener noreferrer">前端工程化<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>前端工程化可以分成四个方面来说，分别为模块化、组件化、规范化和自动化。</p><h4 id="模块化" tabindex="-1"><a class="header-anchor" href="#模块化" aria-hidden="true">#</a> 模块化</h4><p>模块化是指将一个文件拆分成多个相互依赖的文件，最后进行统一的打包和加载，这样能够很好的保证高效的多人协作。其中包含</p><ul><li>JS 模块化：CommonJS、AMD、CMD 以及 ES6 Module。</li><li>CSS 模块化：Sass、Less、Stylus、<a href="https://www.bemcss.com/" target="_blank" rel="noopener noreferrer">BEM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（<code>即模块名 + 元素名 + 修饰器名</code>。）、CSS Modules 等。其中预处理器和 BEM 都会有的一个问题就是样式覆盖。而 CSS Modules 则是通过 JS 来管理依赖，最大化的结合了 JS 模块化和 CSS 生态，比如 Vue 中的 style scoped。</li><li>资源模块化：任何资源都能以模块的形式进行加载，目前大部分项目中的文件、CSS、图片等都能直接通过 JS 做统一的依赖关系处理。</li></ul><h4 id="组件化" tabindex="-1"><a class="header-anchor" href="#组件化" aria-hidden="true">#</a> 组件化</h4><p>不同于模块化，模块化是对文件、对代码和资源拆分，而组件化则是对 UI 层面的拆分。 通常，我们会需要对页面进行拆分，将其拆分成一个一个的零件，然后分别去实现这一个个零件，最后再进行组装。 在我们的实际业务开发中，对于组件的拆分我们需要做不同程度的考量，其中主要包括细粒度和通用性这两块的考虑。 对于业务组件，你更多需要考量的是针对你负责业务线的一个适用度，即你设计的业务组件是否成为你当前业务的 “通用” 组件。</p><h4 id="规范化" tabindex="-1"><a class="header-anchor" href="#规范化" aria-hidden="true">#</a> 规范化</h4><p>正所谓无规矩不成方圆，一些好的规范则能很好的帮助我们对项目进行良好的开发管理。规范化指的是我们在工程开发初期以及开发期间制定的系列规范，其中又包含了</p><ul><li>项目目录结构</li><li>编码规范：对于编码这块的约束，一般我们都会采用一些强制措施，比如 ESLint、StyleLint 等。</li><li>联调规范</li><li>文件命名规范</li><li>样式管理规范：目前流行的样式管理有 BEM、Sass、Less、Stylus、CSS Modules 等方式。</li><li>git flow 工作流：其中包含分支命名规范、代码合并规范等。</li><li>定期 code review</li><li>… 等等</li></ul><h4 id="自动化" tabindex="-1"><a class="header-anchor" href="#自动化" aria-hidden="true">#</a> 自动化</h4><p>从最早先的 grunt、gulp 等，再到目前的 webpack、parcel。这些自动化工具在自动化合并、构建、打包都能为我们节省很多工作。而这些只是前端自动化其中的一部分，前端自动化还包含了持续集成、自动化测试等方方面面。</p><h3 id="monorepo" tabindex="-1"><a class="header-anchor" href="#monorepo" aria-hidden="true">#</a> Monorepo</h3><p>总结作用</p><ol><li>单仓库实现将各包统一收敛在packages中，在上层统一统筹管理各个package的依赖、构建、开发/调试、测试、版本、发布，提供更优雅的多包管理和协作方案。</li><li>用于单仓库多项目管理，组件页面复用，代码规范统一。</li></ol><p>Monorepo 的全称是 monolithic repository，即单体式仓库，与之对应的是 Multirepo(multiple repository)，这里的“单”和“多”是指每个仓库中所管理的模块数量。</p><p>Monorepo就是把<strong>多个项目放在一个仓库里面</strong>，相对立的是传统的 <code>MultiRepo</code> 模式，即每个项目对应一个单独的仓库来分散管理。</p><p>Monorepo解决了：</p><ol><li>代码复用</li><li>版本管理</li><li>项目基建：由于在 MultiRepo 当中，各个项目的工作流是割裂的，因此每个项目需要单独配置开发环境、配置 CI 流程、配置部署发布流程等等，甚至每个项目都有自己单独的一套脚手架工具。</li></ol><h4 id="收益" tabindex="-1"><a class="header-anchor" href="#收益" aria-hidden="true">#</a> 收益</h4><ol><li>首先是<strong>工作流的一致性</strong>，由于所有的项目放在一个仓库当中，复用起来非常方便，如果有依赖的代码变动，那么用到这个依赖的项目当中会立马感知到。并且所有的项目都是使用最新的代码，不会产生其它项目版本更新不及时的情况。</li><li>其次是<strong>项目基建成本的降低</strong>，所有项目复用一套标准的工具和规范，无需切换开发环境，如果有新的项目接入，也可以直接复用已有的基建流程，比如 CI 流程、构建和发布流程。这样只需要很少的人来维护所有项目的基建，维护成本也大大减低。</li><li>再者，<strong>团队协作也更加容易</strong>，一方面大家都在一个仓库开发，能够方便地共享和复用代码，方便检索项目源码，另一方面，git commit 的历史记录也支持以功能为单位进行提交，之前对于某个功能的提交，需要改好几个仓库，提交多个 commit，现在只需要提交一次，简化了 commit 记录，方便协作。</li></ol><p><img src="/assets/monorepo.98f9ea81.png" alt=""></p><p><img src="/assets/monorepovsMutirepo.0f9067f4.png" alt=""></p><h4 id="lerna" tabindex="-1"><a class="header-anchor" href="#lerna" aria-hidden="true">#</a> lerna</h4><p>A tool for managing JavaScript projects with multiple packages.</p><ul><li>使用yarn workspaces单纯的处理依赖问题。</li><li>用lerna来处理统筹管理package的问题。</li></ul><ol><li>自动解决packages之间的依赖关系</li><li>通过 git 检测文件改动，自动发布</li><li>根据 git 提交记录，自动生成 CHANGELOG</li></ol><ul><li><a href="https://mp.weixin.qq.com/s/Qf65Pk0t1n0L1s7Fv-XZewhttps://mp.weixin.qq.com/s/Qf65Pk0t1n0L1s7Fv-XZew" target="_blank" rel="noopener noreferrer">彻底搞懂基于 Monorepo 的 lerna 模块<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="babel" tabindex="-1"><a class="header-anchor" href="#babel" aria-hidden="true">#</a> Babel</h2><p><strong>Babel is a JavaScript compiler.</strong></p><p>Babel就是一个JavaScript编译器，babel编译分为三个阶段，<strong>解析（parse），转换（transform），生成（generate）</strong>。 Babel本身不支持转换，转换是通过一个个 plugin实现。</p><p><img src="/assets/babel.2ff22ff8.png" alt=""></p><p>Babel的架构</p><p><img src="/assets/babel_Architecture.e94db5d6.png" alt=""></p><p><a href="https://mp.weixin.qq.com/s/1OyBkl5NnFO1q86L7GjQwg" target="_blank" rel="noopener noreferrer">Babel介绍<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.cn/post/6844904008679686152" target="_blank" rel="noopener noreferrer">Babel7<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.jianshu.com/p/e9b94b2d52e2" target="_blank" rel="noopener noreferrer">深入理解Babel原理及其使用<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.cn/post/6844903956905197576" target="_blank" rel="noopener noreferrer">深入浅出 Babel<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="/assets/babel_process.26f7feef.png" alt=""></p><h4 id="parse" tabindex="-1"><a class="header-anchor" href="#parse" aria-hidden="true">#</a> parse</h4><p>分为<strong>词法解析</strong>(Lexical Analysis)和<strong>语法解析</strong>(Syntactic Analysis)</p><p>词法解析器(Tokenizer)在这个阶段将字符串形式的代码转换为Tokens(令牌). Tokens 可以视作是一些语法片段组成的数组， 每个 Token 中包含了语法片段、位置信息、以及一些类型信息. 这些信息有助于后续的语法分析。词法分析可以简单的理解为分词，利用存在的编程规则，进行匹配转换成token。</p><p>词法分析被抽象为了一个“有限状态自动机”，在某个状态下，满足一些条件后，会进行状态转移，转移到新的状态，从代码层面看，是一系列的 switch case 语句。经过词法分析后，代码被准确的切割，每个被切分的词叫做 <code>token</code>。</p><p>语法解析： 语法解析器(Parser)会把Tokens转换为抽象语法树(Abstract Syntax Tree，AST)，要做到语法分析，其实要做的就是对于语言要进行建模与抽象，就是一系列的规则的匹配与嵌套，优先级低的规则嵌套优先级高的规则（这样才能保证优先级高的先执行）</p><h4 id="transform" tabindex="-1"><a class="header-anchor" href="#transform" aria-hidden="true">#</a> transform</h4><p>AST 遍历和转换会使用<strong>访问者模式</strong>。访问者会以<code>深度优先</code>的顺序, 或者说<code>递归</code>地对 AST 进行遍历, <code>@babel/traverse</code>，实现了访问者模式，对 AST 进行遍历，<strong>转换插件</strong>会通过它获取感兴趣的AST节点，对节点继续操作</p><p><img src="/assets/babe_tool_package.2b8cb171.png" alt=""></p><h4 id="polyfill和runtime的区别" tabindex="-1"><a class="header-anchor" href="#polyfill和runtime的区别" aria-hidden="true">#</a> polyfill和runtime的区别</h4><p><code>polyfil</code>l是会污染原来的全局环境的（因为新的原生对象、API这些都直接由polyfill引入到全局环境）。这样就很容易会发生冲突。对于库library来说，是供外部使用的，但外部的环境并不在library的可控范围。所以runtime就是解决这个问题的，避免全局污染。</p><p>babel-plugin-transform-runtime插件依赖babel-runtime，babel-runtime是真正提供runtime环境的包；也就是说transform-runtime插件是把js代码中使用到的新原生对象和静态方法转换成对runtime实现包的引用，举个例子如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 输入的ES6代码</span>
<span class="token keyword">var</span> sym <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过transform-runtime转换后的ES5+runtime代码 </span>
<span class="token keyword">var</span> _symbol <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;babel-runtime/core-js/symbol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sym <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _symbol<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>原本代码中使用的ES6新原生对象Symbol被transform-runtimec插件转换成了babel-runtime的实现，既保持了Symbol的功能，同时又没有像polyfill那样污染全局环境（因为最终生成的代码中，并没有对Symbol的引用）。</p><h4 id="transform-runtime插件的功能" tabindex="-1"><a class="header-anchor" href="#transform-runtime插件的功能" aria-hidden="true">#</a> transform-runtime插件的功能</h4><ol><li>把代码中的使用到的ES6引入的新原生对象和静态方法用babel-runtime/core-js导出的对象和方法替代</li><li>当使用generators或async函数时，用babel-runtime/regenerator导出的函数取代（类似polyfill分成regenerator和core-js两个部分）</li><li>把Babel生成的辅助函数改为用babel-runtime/helpers导出的函数来替代（babel默认会在每个文件顶部放置所需要的辅助函数，如果文件多的话，这些辅助函数就在每个文件中都重复了，通过引用babel-runtime/helpers就可以统一起来，减少代码体积）</li></ol><p>上述三点就是transform-runtime插件所做的事情，由此也可见，babel-runtime就是一个提供了regenerator、core-js和helpers的运行时库。 建议不要直接使用babel-runtime，因为transform-runtime依赖babel-runtime，大部分情况下都可以用transform-runtime达成目的。</p><h2 id="core-js" tabindex="-1"><a class="header-anchor" href="#core-js" aria-hidden="true">#</a> core-js</h2><h3 id="core-js介绍" tabindex="-1"><a class="header-anchor" href="#core-js介绍" aria-hidden="true">#</a> core-js介绍</h3><p>其实core-js是我们能够使用新的API的最重要的包，然而一般情况它隐藏在webpack编译后的代码中，我们一般不会去查看，所以容易被遗忘，我们在webpack生成环境下，查看编译后的代码，可以看到例如includes就是从core-js导出到我们的代码去的。</p><p><img src="/assets/core_js.b8cae941.png" alt=""></p><h4 id="core-js是什么" tabindex="-1"><a class="header-anchor" href="#core-js是什么" aria-hidden="true">#</a> core-js是什么</h4><ul><li><strong>它是JavaScript标准库的polyfill</strong></li><li>它尽可能的进行模块化，让你能选择你需要的功能</li><li><strong>它可以不污染全局空间</strong></li><li>它和babel高度集成，可以对core-js的引入进行最大程度的优化</li></ul><h3 id="core-js-3-特性概览" tabindex="-1"><a class="header-anchor" href="#core-js-3-特性概览" aria-hidden="true">#</a> <a href="https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md#babelpreset-env" target="_blank" rel="noopener noreferrer">core-js@3 特性概览<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><ul><li><p>支持ECMAScript稳定功能，引入core-js@3冻结期间的新功能，比如flat</p></li><li><p>加入到ES2016-ES2019中的提案，现在已经被标记为稳定功能</p></li><li><p><strong>更新了提案的实现，增加了proposals配置项，由于提案阶段不稳定，需要谨慎使用</strong></p></li><li><p><strong>增加了对一些web标准的支持，比如URL 和 URLSearchParams</strong></p></li><li><p><strong>现在支持原型方法，同时不污染原型</strong></p></li><li><p>删除了过时的特性</p></li></ul><h3 id="core-js-3与babel" tabindex="-1"><a class="header-anchor" href="#core-js-3与babel" aria-hidden="true">#</a> core-js@3与babel</h3><p>以前我们实现API的时候，会引入整个polyfill，其实polyfill只是包括了以下两个包</p><ul><li><code>core-js</code></li><li><code>regenerator-runtime</code>: Standalone runtime for Regenerator-compiled generator and async functions.即<code>generator</code>和<code>async</code>的polyfill包</li></ul><p><code>core-js@3</code>升级之后弃用了<code>@babel/polyfill</code>，以下是等价实现。polyfill是一个针对ES2015+环境的shim，实现上来说<code>babel-polyfill</code>包只是简单的把<code>core-js</code>和<code>regenerator runtime</code>包装了下。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// babel.config.ts</span>
<span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token string">&quot;entry&quot;</span><span class="token punctuation">,</span> <span class="token comment">// or &quot;usage&quot;</span>
    <span class="token literal-property property">corejs</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token keyword">import</span> <span class="token string">&quot;core-js/stable&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;regenerator-runtime/runtime&quot;</span><span class="token punctuation">;</span> <span class="token comment">//  Standalone runtime for Regenerator-compiled generator and async functions. 解决generate和async的兼用问题</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="vue-cli3下-browserslistrc文件含义" tabindex="-1"><a class="header-anchor" href="#vue-cli3下-browserslistrc文件含义" aria-hidden="true">#</a> vue/cli3下.browserslistrc文件含义</h4><p>browserslist是用来配置项目的目标浏览器和nodejs版本范围，也就是通常说的兼容哪些浏览器的版本。</p><ul><li>&quot; &gt;1%&quot; :代表着全球超过1%人使用的浏览器</li><li>“last 2 versions” : 表示所有浏览器兼容到最后两个版本</li><li>“not ie &lt;=8” :表示IE浏览器版本大于8（实则用npx browserslist 跑出来不包含IE9 ）</li><li>“safari &gt;=7”:表示safari浏览器版本大于等于7</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&gt; 1%
last 2 versions
not dead
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="实现一个简单的按需打包功能babel插件" tabindex="-1"><a class="header-anchor" href="#实现一个简单的按需打包功能babel插件" aria-hidden="true">#</a> 实现一个简单的按需打包功能babel插件</h5><p>例如 <code>ElementUI</code> 中把 <code>import { Button } from &#39;element-ui&#39;</code> 转成 <code>import Button from &#39;element-ui/lib/button&#39;</code></p><p>可以先对比下 <code>AST</code> ：</p><details class="custom-container details"><summary>点击查看代码</summary><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// import { Button } from &#39;element-ui&#39;
{
    &quot;type&quot;: &quot;Program&quot;,
    &quot;body&quot;: [
        {
            &quot;type&quot;: &quot;ImportDeclaration&quot;,
            &quot;specifiers&quot;: [
                {
                    &quot;type&quot;: &quot;ImportSpecifier&quot;,
                    &quot;local&quot;: {
                        &quot;type&quot;: &quot;Identifier&quot;,
                        &quot;name&quot;: &quot;Button&quot;
                    },
                    &quot;imported&quot;: {
                        &quot;type&quot;: &quot;Identifier&quot;,
                        &quot;name&quot;: &quot;Button&quot;
                    }
                }
            ],
            &quot;source&quot;: {
                &quot;type&quot;: &quot;Literal&quot;,
                &quot;value&quot;: &quot;element-ui&quot;,
                &quot;raw&quot;: &quot;&#39;element-ui&#39;&quot;
            }
        }
    ],
    &quot;sourceType&quot;: &quot;module&quot;
}

// import Button from &#39;element-ui/lib/button&#39;
{
    &quot;type&quot;: &quot;Program&quot;,
    &quot;body&quot;: [
        {
            &quot;type&quot;: &quot;ImportDeclaration&quot;,
            &quot;specifiers&quot;: [
                {
                    &quot;type&quot;: &quot;ImportDefaultSpecifier&quot;,
                    &quot;local&quot;: {
                        &quot;type&quot;: &quot;Identifier&quot;,
                        &quot;name&quot;: &quot;Button&quot;
                    }
                }
            ],
            &quot;source&quot;: {
                &quot;type&quot;: &quot;Literal&quot;,
                &quot;value&quot;: &quot;element-ui/lib/button&quot;,
                &quot;raw&quot;: &quot;&#39;element-ui/lib/button&#39;&quot;
            }
        }
    ],
    &quot;sourceType&quot;: &quot;module&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div></details><p>可以发现， <code>specifiers</code> 的 <code>type</code> 和 <code>source</code> 的 <code>value</code>、<code>raw</code> 不同。</p><p>然后 <code>ElementUI</code> 官方文档中，<code>babel-plugin-component</code> 的配置如下：</p><details class="custom-container details"><summary>点击查看代码</summary><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// 如果 plugins 名称的前缀为 &#39;babel-plugin-&#39;，你可以省略 &#39;babel-plugin-&#39; 部分
{
  &quot;presets&quot;: [[&quot;es2015&quot;, { &quot;modules&quot;: false }]],
  &quot;plugins&quot;: [
    [
      &quot;component&quot;,
      {
        &quot;libraryName&quot;: &quot;element-ui&quot;,
        &quot;styleLibraryName&quot;: &quot;theme-chalk&quot;
      }
    ]
  ]
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> babel <span class="token keyword">from</span> <span class="token string">&#39;@babel/core&#39;</span>

<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import { Button } from &#39;element-ui&#39;</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> result <span class="token punctuation">}</span> <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token literal-property property">types</span><span class="token operator">:</span> t<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> <span class="token punctuation">{</span> opts <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token punctuation">{</span> specifiers<span class="token punctuation">,</span> source <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> path
                        <span class="token comment">// 比较 source 的 value 值 与配置文件中的库名称</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>value <span class="token operator">===</span> opts<span class="token punctuation">.</span>libraryName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">const</span> arr <span class="token operator">=</span> specifiers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">specifier</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                                t<span class="token punctuation">.</span><span class="token function">importDeclaration</span><span class="token punctuation">(</span>
                                
                                    <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">ImportDefaultSpecifier</span><span class="token punctuation">(</span>specifier<span class="token punctuation">.</span>local<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    <span class="token comment">// 拼接详细路径</span>
                                    t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>specifier<span class="token punctuation">.</span>local<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
                                <span class="token punctuation">)</span>
                            <span class="token punctuation">)</span><span class="token punctuation">)</span>
                            path<span class="token punctuation">.</span><span class="token function">replaceWithMultiple</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// import Button from &quot;element-ui/lib/Button&quot;;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></details><h2 id="postcss" tabindex="-1"><a class="header-anchor" href="#postcss" aria-hidden="true">#</a> postcss</h2><ul><li><a href="https://mp.weixin.qq.com/s/TAKvKLXIG25gnuHSzt7Edg" target="_blank" rel="noopener noreferrer">神奇的 postcss<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="简述webpack工作流程" tabindex="-1"><a class="header-anchor" href="#简述webpack工作流程" aria-hidden="true">#</a> 简述webpack工作流程</h2><h3 id="概念" tabindex="-1"><a class="header-anchor" href="#概念" aria-hidden="true">#</a> 概念</h3><p><strong>Entry</strong>：入口，Webpack 执行构建的第一步将从 Entry 开始，可抽象成输入。指示 webpack 应该使用哪个模块，来作为构建其内部 <code>依赖图(dependency graph) </code>的开始。进入入口起点后，webpack 会找出有哪些模块和库是入口起点（直接和间接）依赖的。 默认值是 <code>./src/index.js</code>，但你可以通过在<code>webpack configuration</code>中配置 entry 属性，来指定一个（或多个）不同的入口起点。</p><p><strong>Output</strong>：输出结果，Output属性告诉 webpack 在哪里输出它所创建的 bundle，以及如何命名这些文件。主要输出文件的默认值是 <code>./dist/main.js</code>，其他生成文件默认放置在 <code>./dist </code>文件夹中。</p><p><strong>Loader</strong>：模块转换器，用于把模块原内容按照需求转换成新内容，webpack 只能理解 JavaScript 和 JSON 文件，loader 让 webpack 能够去处理其他类型的文件，并将它们转换为有效 模块，以供应用程序使用，以及被添加到依赖图中。 在更高层面，在 webpack 的配置中，loader 有两个属性：1、<code>test</code> 属性，识别出哪些文件会被转换。2、<code>use</code> 属性，定义出在进行转换时，应该使用哪个 loader。 Loader 本质上就是一个函数，对接收到的内容进行转换，返回转换后的结果。</p><p><strong>Plugin</strong>：扩展插件，loader 用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。包括：打包优化，资源管理，注入环境变量。Plugin 就是在 Webpack 的生命周期中进行各种操作，从而达到使用者目的插件。</p><p><strong>mode</strong>: 模式，通过选择 development, production 或 none 之中的一个，来设置 mode 参数，可以启用 webpack 内置在相应环境下的优化。其默认值为 production。</p><p><strong>Module</strong>：模块，在 Webpack 里一切皆模块，一个模块对应着一个文件。Webpack 会从配置的 Entry 开始递归找出所有依赖的模块。</p><p>webpack 模块能以各种方式表达它们的依赖关系。下面是一些示例：</p><ul><li>ES2015 <code>import</code> 语句</li><li>CommonJS <code>require()</code> 语句</li><li>AMD <code>define</code> 和 <code>require</code> 语句</li><li>css/sass/less 文件中的 <code>@import</code> 语句。</li><li>stylesheet <code>url(...)</code> 或者 HTML <code>&lt;img src=...&gt; </code>文件中的图片链接。</li></ul><p><strong>Chunk</strong>：代码块，一个 Chunk 由多个模块组合而成，用于代码合并与分割。</p><p><code>Chunk</code>是代码块的意思，Webpack在执行构建的时候，会把多个模块合并为一个文件，该文件就称为<code>Chunk</code>。</p><p>Webpack 会为每个生成的 <code>Chunk</code> 取一个名称，<code>Chunk</code> 的名称和 <code>Entry</code> 的配置有关：</p><ul><li>如果 <code>entry</code> 是一个 <code>string</code> 或 <code>array</code>，就只会生成一个 <code>Chunk</code>，这时 <code>Chunk </code>的名称是 <code>main</code>；</li><li>如果 <code>entry</code> 是一个 <code>object</code>，就可能会出现多个 <code>Chunk</code>，这时 <code>Chunk </code>的名称是 <code>object</code> 键值对里键的名称。</li></ul><h3 id="构建过程" tabindex="-1"><a class="header-anchor" href="#构建过程" aria-hidden="true">#</a> 构建过程</h3><p>关于 webpack 的工作流程，简单来说可以概括为以下几步：</p><ul><li>（1）初始化参数</li></ul><p>解析 Webpack 配置参数，合并 <code>Shell</code> 传入和 <code>webpack.config.ts</code> 文件配置的参数，形成最后的配置结果。</p><ul><li>（2）开始编译</li></ul><p>上一步得到的参数初始化 <code>compiler</code> 对象，注册所有配置的插件，插件监听 Webpack 构建生命周期的事件节点，做出相应的反应，执行对象的 run 方法开始执行编译。</p><ul><li>（3）确定入口</li></ul><p>从配置文件（ <code>webpack.config.ts</code> ）中指定的 <code>entry</code> 入口，开始解析文件构建 <code>AST</code> 语法树，找出依赖，递归下去。</p><ul><li>（4）编译模块</li></ul><p>递归中根据<code>文件类型</code>和 <code>loader</code> 配置，调用所有配置的 <code>loader</code> 对文件进行转换，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理。</p><ul><li>（5）完成模块编译并输出</li></ul><p>递归完后，得到每个文件结果，包含每个模块以及他们之间的依赖关系，根据 <code>entry</code> 配置生成代码块 <code>chunk</code> 。</p><ul><li>（6）输出完成</li></ul><p>输出所有的 chunk 到文件系统。</p><p><a href="https://mp.weixin.qq.com/s/NblP7A604kByp7pfdjcS0g" target="_blank" rel="noopener noreferrer">简单实现<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>精简流程</p><ol><li><p>初始化：启动构建，读取与合并配置参数，加载 Plugin，实例化 Compiler。</p></li><li><p>编译：从 Entry 发出，针对每个 Module 串行调用对应的 Loader 去翻译文件内容，再找到该 Module 依赖的 Module，递归地进行编译处理。</p></li><li><p>输出：对编译后的 Module 组合成 Chunk，把 Chunk 转换成文件，输出到文件系统。</p></li></ol><p><img src="/assets/webpack_progress.106dee03.png" alt=""></p><h3 id="打包过程" tabindex="-1"><a class="header-anchor" href="#打包过程" aria-hidden="true">#</a> 打包过程</h3><p>webpack的运行流程是一个串行的过程，从启动到结束会依次执行以下流程：</p><ol><li>初始化参数</li><li>开始编译 用上一步得到的参数初始<code>Compiler</code>对象，加载所有配置的插件，通过执行对象的<code>run</code>方法开始执行编译</li><li>确定入口 根据配置中的 <code>Entry</code> 找出所有入口文件</li><li>编译模块 从入口文件出发，调用所有配置的 <code>Loader</code> 对模块进行编译，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理</li><li>完成模块编译 在经过第4步使用 <code>Loader</code> 翻译完所有模块后， 得到了每个模块被编译后的最终内容及它们之间的依赖关系</li><li>输出资源：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 <code>Chunk</code>，再将每个 <code>Chunk</code> 转换成一个单独的文件加入输出列表中，这是可以修改输出内容的最后机会</li><li>输出完成：在确定好输出内容后，根据配置确定输出的路径和文件名，将文件的内容写入文件系统中。</li></ol><p>在以上过程中， Webpack 会在特定的时间点广播特定的事件，插件在监听到感兴趣的事件后会执行特定的逻辑，井且插件可以调用 Webpack 提供的 API 改变 Webpack 的运行结果。其实以上7个步骤，可以简单归纳为初始化、编译、输出，三个过程，而这个过程其实就是前面说的基本模型的扩展。</p><h3 id="常用loader" tabindex="-1"><a class="header-anchor" href="#常用loader" aria-hidden="true">#</a> 常用loader</h3><ul><li><p>file-loader：把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件，当引入的文件是 <code>.png</code>、<code>.txt </code>等时，可以通过 <code>file-loader</code> 解析项目中的 <code>url </code>引入。根据配置将文件拷贝到相应的路径，并修改打包后文件的引入路径，让它指向正确的文件。;</p></li><li><p>url-loader：<code>url-loader</code> 封装了 <code>file-loader</code> 且可以不依赖于 <code>file-loader</code> 单独使用，并且可以配置 <code>limit</code>。对小于 limit 大小的图片转换成 <code>Base64</code>，大于 limit 的时候使用 file-loader 里的方法。</p></li><li><p>source-map-loader：加载额外的 Source Map 文件，以方便断点调试;</p></li><li><p>image-loader：加载并且压缩图片文件;</p></li><li><p>babel-loader：把 ES6 转换成 ES5;</p></li><li><p>css-loader：The css-loader interprets @import and url() like import/require() and will resolve them. 负责处理 <code>@import</code>、<code>url</code> 等语句。例如 <code>import css from &#39;file.css&#39;</code>、<code>url(image.png)</code>支持模块化、压缩、文件导入等特性；把 CSS 代码注入到 JavaScript 中</p></li><li><p>style-loader：Inject CSS into the DOM，在 DOM 里插入一个 <code>&lt;style&gt;</code> 标签，并且将 CSS 写入这个标签内;</p></li><li><p>postcss-loader：负责进一步处理 CSS 文件，比如添加浏览器前缀，压缩 CSS 等。</p></li><li><p>less-loader：将 .less 文件内容转换成 CSS。</p></li><li><p>sass-loader：将 .sass 文件内容转换成 CSS。</p></li><li><p>eslint-loader：通过 ESLint 检查 JavaScript 代码;</p></li></ul><h3 id="常用plugin" tabindex="-1"><a class="header-anchor" href="#常用plugin" aria-hidden="true">#</a> 常用plugin</h3><ul><li>HotModuleReplacementPlugin：webpack内置的模块热更新插件。Hot-Module-Replacement 的热更新是依赖于 webpack-dev-server，后者是在打包文件改变时更新打包文件或者 reload 刷新整个页面，HRM 是只更新修改的部分。</li><li>clean-webpack-plugin：打包前自动清理 dist 目录，防止文件残留。</li><li>terser-webpack-plugin： Webpack4.0 默认是使用 terser-webpack-plugin 这个压缩插件</li><li>compression-webpack-plugin：gzip 压缩</li><li>copy-webpack-plugin：将单个文件或者整个目录复制到构建目录</li><li>mini-css-extract-plugin：将 CSS 抽离出来单独打包并且通过配置可以设置是否压缩。</li><li>html-webpack-plugin：这个插件可以配置生成一个 HTML5 文件，其中 script 标签包含所有 Webpack 包。如果你设置多个入口点，你可以据此实现多页面应用打包。</li><li>webpack-bundle-analyzer：打包分析插件</li><li>speed-measure-webpack-plugin: 打包速度分析，<strong>HardSourceWebpackPlugin 和 speed-measure-webpack-plugin 不能一起使用</strong></li><li><a href="https://github.com/mzgoddard/hard-source-webpack-plugin" target="_blank" rel="noopener noreferrer">hard-source-webpack-plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（Webpack 4 的打包性能足够好的，dll继续维护的必要了, HardSourceWebpackPlugin is a plugin for webpack to provide an intermediate caching step for modules. In order to see results, you&#39;ll need to run webpack twice with this plugin: the first build will take the normal amount of time. The second build will be significantly faster.)</li></ul><h3 id="热更新" tabindex="-1"><a class="header-anchor" href="#热更新" aria-hidden="true">#</a> 热更新</h3><h4 id="轻松理解webpack热更新原理" tabindex="-1"><a class="header-anchor" href="#轻松理解webpack热更新原理" aria-hidden="true">#</a> <a href="https://mp.weixin.qq.com/s/2L9Y0pdwTTmd8U2kXHFlPA" target="_blank" rel="noopener noreferrer">轻松理解webpack热更新原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="了不起的-webpack-hmr-学习指南-含源码分析" tabindex="-1"><a class="header-anchor" href="#了不起的-webpack-hmr-学习指南-含源码分析" aria-hidden="true">#</a> <a href="https://mp.weixin.qq.com/s?__biz=MjM5MDc4MzgxNA==&amp;mid=2458455505&amp;idx=1&amp;sn=b6d5258393b5c41b77cdc78299e94697&amp;chksm=b1c22df886b5a4eed560aa9aa95bc27d473d58ebabb501ec98c282bdbc8308e9951cea59a060&amp;scene=178&amp;cur_album_id=1556921519803596802#rd" target="_blank" rel="noopener noreferrer">了不起的 Webpack HMR 学习指南（含源码分析）<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>在 Webpack 的 webpack.config.ts 中：</p><ol><li>配置 devServer 的 hot 为 true</li><li>在 plugins 中增加 new webpack.HotModuleReplacementPlugin()</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// webpack.config.ts</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//....</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 热更新插件</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>并且在入口文件配置：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="热更新原理" tabindex="-1"><a class="header-anchor" href="#热更新原理" aria-hidden="true">#</a> 热更新原理</h4><p><code>HMR</code>（Hot Module Replacement） 的核心就是客户端从服务端拉去更新后的文件，准确的说是 <code>chunk diff</code>（chunk 需要更新的部分）。 实际上 <code>webpack-dev-server（WDS）</code>与浏览器之间维护了一个<code> Websocket</code>，当本地资源发生变化时，<code>WDS</code> 会向浏览器推送更新，并带上构建时的 <code>hash</code>，让客户端与上一次资源进行对比。 客户端对比出差异后会向 <code>WDS</code> 发起<code> Ajax</code> 请求来获取更改内容（文件列表、hash），这样客户端就可以再借助这些信息继续向 <code>WDS</code> 发起 <code>jsonp</code> 请求获取该 <code>chunk</code> 的增量更新。 后续的部分（拿到增量更新之后如何处理？哪些状态该保留？哪些又需要更新？）由 <code>HotModulePlugin</code> 来完成，提供了相关 API 以供开发者针对自身场景进行处理，像 <code>react-hot-loader</code> 和 <code>vue-loader</code> 都是借助这些 API 实现 HMR。</p><h3 id="_3种hash" tabindex="-1"><a class="header-anchor" href="#_3种hash" aria-hidden="true">#</a> 3种hash</h3><p>文件指纹是打包后输出的文件名的后缀，对应着 3 种 hash。</p><ol><li><code>hash </code>是跟整个项目的构建相关，只要项目里有文件更改，整个项目构建的 <code>hash</code> 值都会更改，并且全部文件都共用相同的 <code>hash</code> 值。（粒度: 整个项目）一旦只修改某一个文件，打包后就会造成所有文件的hash值都会改变，会导致未曾修改的文件的hash值变化，进一步会导致未修改的文件在浏览器的缓存失效了---不常用</li><li><code>chunkhash </code>是根据不同的入口进行依赖文件解析，构建对应的 chunk（代码块），生成对应的 hash 值。只有被修改的 chunk 在重新构建之后才会生成新的 hash 值，不会影响其它的 chunk。如果在某一入口文件创建的关系依赖图上存在文件内容发生了变化，那么相应的入口文件的chunkhash才会发生变化，否则chunkhash就不会变化，所以chunkhash受它自身chunk的文件内容的影响，只要该chunk中的内容有变化，chunkhash就会变。（粒度:entry 的每个入口文件）因此一般在项目中会把公共库和其他文件拆开，并把公共库代码拆分到一起进行打包，因为公共库的代码变动较少，这样可以实现公共库的长效缓存。webpack4中支持了异步import功能，固，chunkhash也作用于此</li><li><code>contenthash</code> 是跟每个生成的文件有关，每个文件都有一个唯一的 hash 值。当要构建的文件内容发生改变时，就会生成新的 hash 值，且该文件的改变并不会影响和它同一个模块下的其它文件。（粒度: 每个文件的内容） 使用chunkhash还存在一个问题，当一个JS文件引入了CSS文件（import &#39;xxx.css&#39;），打包构建后它们的chunkhash值是相同的，因此如果更改了JS文件的内容，即使CSS文件内容没有更改，那么与这个JS关联的CSS文件的chunkhash也会跟着改变，这样就会导致未改变的CSS文件的缓存失效了。针对这种情况，我们可以使用mini-css-extract-plugin插件将CSS从JS文件中抽离出来并使用contenthash，来解决上述问题</li></ol><p><code>filename</code> 就是对应于 entry 里面的输入文件，经过webpack 打包后输出文件的文件名。指列在 <code>entry</code> 中，打包后输出的文件的名称。</p><p><code>chunkFilename</code> 指未列在 entry 中，却又需要被打包出来的文件的名称。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
	    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// publicPath: &#39;./test&#39;,</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;js/[name].[hash].bundle.js&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&#39;js/[name].[chunkhash].js&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;css/[name].[contenthash].css&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&#39;css/[name].[contenthash].css&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// new BundleAnalyzerPlugin(),</span>
            <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="code-splitting" tabindex="-1"><a class="header-anchor" href="#code-splitting" aria-hidden="true">#</a> Code Splitting</h3><p>webpack 4 废弃了之前的不怎么好用的 <code>CommonsChunk</code>，取而代之的是 <code>SplitChunks</code>。</p><p>首先 webpack 总共提供了三种办法来实现 Code Splitting，如下：</p><ul><li>入口配置：entry 入口使用多个入口文件；</li><li>抽取公有代码：使用 SplitChunks 抽取公有代码；</li><li>动态加载 ：动态加载一些代码。</li></ul><h4 id="splitchunks" tabindex="-1"><a class="header-anchor" href="#splitchunks" aria-hidden="true">#</a> SplitChunks</h4><ul><li><a href="https://www.cnblogs.com/kwzm/p/10314438.html" target="_blank" rel="noopener noreferrer">理解webpack4.splitChunks<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 默认配置</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;async&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 参数可能是：all，async和initial，这里表示拆分异步模块。</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 如果模块的大小大于30kb，才会被拆分</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 按需加载时最大的请求数，意思就是说，如果拆得很小，就会超过这个值，限制拆分的数量。</span>
      <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 入口处的最大请求数</span>
      <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">&#39;~&#39;</span><span class="token punctuation">,</span> <span class="token comment">// webpack将使用块的名称和名称生成名称（例如vendors~main.js）</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 拆分块的名称</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 缓存splitchunks</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 一个模块至少出现2次引用时，才会被拆分</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>参数说明如下：</p><ul><li>chunks：表示从哪些chunks里面抽取代码，除了三个可选字符串值 initial、async、all 之外，还可以通过函数来过滤所需的 chunks；</li><li>minSize：表示抽取出来的文件在压缩前的最小大小，默认为 30000；</li><li>maxSize：表示抽取出来的文件在压缩前的最大大小，默认为 0，表示不限制最大大小；</li><li>minChunks：表示被引用次数，默认为1；</li><li>maxAsyncRequests：最大的按需(异步)加载次数，默认为 5；</li><li>maxInitialRequests：最大的初始化加载次数，默认为 3；</li><li>automaticNameDelimiter：抽取出来的文件的自动生成名字的分割符，默认为 ~；</li><li>name：抽取出来文件的名字，默认为 true，表示自动生成文件名；</li><li>cacheGroups: 缓存组。（这才是配置的关键）</li></ul><h4 id="配置css文件压缩成一个" tabindex="-1"><a class="header-anchor" href="#配置css文件压缩成一个" aria-hidden="true">#</a> 配置css文件压缩成一个</h4><details class="custom-container details"><summary>点击查看代码</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>    config<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span><span class="token function">splitChunks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将动态引入的css合并成一个css文件</span>
        <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;styles&#39;</span><span class="token punctuation">,</span>
          <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token parameter">m</span> <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;CssModule&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></details><h4 id="cachegroups" tabindex="-1"><a class="header-anchor" href="#cachegroups" aria-hidden="true">#</a> cacheGroups</h4><p>它可以继承/覆盖上面 splitChunks 中所有的参数值，除此之外还额外提供了三个配置，分别为：test, priority 和 reuseExistingChunk。</p><ul><li>test: 表示要过滤 modules，默认为所有的 modules，可匹配模块路径或 chunk 名字，当匹配的是 chunk 名字的时候，其里面的所有 modules 都会选中；</li><li>priority：表示抽取权重，数字越大表示优先级越高。因为一个 module 可能会满足多个 cacheGroups 的条件，那么抽取到哪个就由权重最高的说了算；</li><li>reuseExistingChunk：表示是否使用已有的 chunk，如果为 true 则表示如果当前的 chunk 包含的模块已经被抽取出去了，那么将不会重新生成新的。</li></ul><h3 id="optimization-splitchunks-中-chunks-的3个值-all、async、initial-的含义" tabindex="-1"><a class="header-anchor" href="#optimization-splitchunks-中-chunks-的3个值-all、async、initial-的含义" aria-hidden="true">#</a> optimization.splitChunks 中，chunks 的3个值：all、async、initial 的含义</h3><ul><li>async表示只从异步加载得模块（动态加载import()）里面进行拆分</li><li>initial表示只从入口模块进行拆分</li><li>all表示以上两者都包括</li></ul><p>chunks有三个选项：initial、async和all。它指示应该优先分离同步（initial）、异步（async）还是所有的代码模块。这里的异步指的是通过动态加载方式（import()）加载的模块。</p><p>这里的重点是优先二字。以async为例，假如你有两个模块 a 和 b，两者都引用了 jQuery，但是 a 模块还通过动态加载的方式引入了 lodash。那么在 async 模式下，插件在打包时会分离出lodash~for~a.js的 chunk 模块，而 a 和 b 的公共模块 jQuery 并不会被（优化）分离出来，所以它可能还同时存在于打包后的a.bundle.js和b.bundle.js文件中。因为async告诉插件优先考虑的是动态加载的模块</p><h4 id="webpack-dll" tabindex="-1"><a class="header-anchor" href="#webpack-dll" aria-hidden="true">#</a> <a href="https://www.cnblogs.com/skychx/p/webpack-dllplugin.html" target="_blank" rel="noopener noreferrer">webpack dll<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h3 id="项目中-你使用-webpack-做了哪些优化" tabindex="-1"><a class="header-anchor" href="#项目中-你使用-webpack-做了哪些优化" aria-hidden="true">#</a> 项目中，你使用 webpack 做了哪些优化</h3><h4 id="构建速度" tabindex="-1"><a class="header-anchor" href="#构建速度" aria-hidden="true">#</a> 构建速度</h4><p>开发环境编译慢: 需要考虑怎么在开发环境做资源缓存，每一次改动代码，让 rebuild 检查的模块越少越快。 分析工具：</p><ul><li><p>speed-measure-webpack-plugin：分析出 Webpack 打包过程中 Loader 和 Plugin 的耗时，有助于找到构建过程中的性能瓶颈。</p></li><li><p>webpack-bundle-analyzer：可视化的方式直观地看到打包的bundle中到底包含哪些模块内容，以及每一个模块的体积大小。可以根据这些信息去分析项目结构，调整打包配置，进行优化。</p></li><li><ol><li>使用 <code>happypack</code>（多进程模型）(它将任务分解给多个子进程去并发执行，子进程处理完后再将结果发给主进程。) 加速构建。v4及以上webpack已使用多线程，没必要使用这个了。在webpack4之后，可以使用thread-loader。<code>thread loader</code>（把这个 loader 放置在其他 loader 之前， 放置在这个 loader 之后的 loader 就会在一个单独的 worker【worker pool】 池里运行，一个worker 就是一个nodeJS 进程【node.js process】，每个单独进程处理时间上限为600ms，各个进程的数据交换也会限制在这个时间内。）</li></ol></li><li><ol start="2"><li>利用缓存：利用缓存可以提升二次构建速度。</li></ol><ul><li>a. 在一些性能开销较大的 <code>loader</code> 之前添加此<code>cache-loader</code>，以将结果缓存到磁盘中。或者babel-loader 的 cacheDirectory， <code>loader: &#39;babel-loader?cacheDirectory=true&#39;,</code>；</li><li>b. hard-source-webpack-plugin(webpack 5)</li></ul></li><li><ol start="3"><li>缩小打包作用域：</li></ol><ul><li>exclude/include （确定 loader 规则范围）</li><li>resolve.modules 指明第三方模块的绝对路径（减少不必要的查找）</li><li>resolve.extensions 尽可能减少后缀尝试的可能性</li><li>noParse 对完全不需要解析的库进行忽略（不去解析但仍会打包到 bundle 中，注意被忽略掉的文件里不应该包含 import、require、define 等模块化语句）</li><li>IgnorePlugin（完全排除模块）</li><li>合理使用 alias</li></ul></li><li><ol start="4"><li>动态链接库</li></ol><ul><li>a. 使用<code>html-webpack-externals-plugin</code>，公共库和UI库html cdn引入或者<code>Externals</code></li><li>b. <a href="https://www.cnblogs.com/skychx/p/webpack-dllplugin.html" target="_blank" rel="noopener noreferrer">dll Plugin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（把每次打包不需要变动的文件（一般类库，如:react,lodash）提前打包好，这样每次打包项目的时候，就不需要单独打包这些文件，从而节约了时间），先使用<code>DllPlugin</code>打包第三方库，在使用<code>DLLReferencePlugin</code>引用<code>manifest.json</code>，去关联第1步中已经打好的包</li></ul></li></ul><h4 id="优化构建体积" tabindex="-1"><a class="header-anchor" href="#优化构建体积" aria-hidden="true">#</a> 优化构建体积</h4><ul><li><ol><li>使用动态import，减小包的体积，路由懒加载，使用webpackChunkName实现更好的分包</li></ol></li><li><ol start="2"><li>代码分割：使用<code>optimization.splitChunks</code>，实现更好的打包，如用<code>cacheGroups-async</code>， 实现css文件合并成一个等</li></ol></li><li><ol start="3"><li>treeShaking： 使用ES6的<code>import/export</code>语法，并且具名导入导出代码，而不要使用<code>export default</code>。</li></ol></li><li><ol start="4"><li>图片压缩( image-webpack-loader)、url-loader图片base64内联，或者雪碧图（postcss-sprites）等</li></ol></li><li><ol start="5"><li>代码压缩: <code>uglifyjs-webpack-plugin</code> 和 <code>terser-webpack-plugin</code>（可以开启多线程压缩）。v4.26.0版本之前，webpack内置的压缩插件是uglifyjs-webpack-plugin，从v4.26.0版本开始，换成了terser-webpack-plugin。</li></ol></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;terser-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>  
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//开启并行压缩，可以加快构建速度</span>
        <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//如果生产环境使用source-maps，则必须设置为true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><ol start="6"><li>gzip：使用webpack生成gzip文件需要借助compression-webpack-plugin，使用配置如下：</li></ol></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> CompressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;compression-webpack-plugin&quot;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token keyword">new</span> <span class="token class-name">CompressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|css)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>         <span class="token comment">//匹配要压缩的文件</span>
       <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&quot;gzip&quot;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><a href="https://juejin.cn/post/6953790342613172237" target="_blank" rel="noopener noreferrer">一文搞定webpack构建优化策略<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/150731200" target="_blank" rel="noopener noreferrer">关于webpack性能调优<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/137120584" target="_blank" rel="noopener noreferrer">vue模块化按需编译，突破编译瓶颈<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="编写loader" tabindex="-1"><a class="header-anchor" href="#编写loader" aria-hidden="true">#</a> <a href="https://v4.webpack.docschina.org/contribute/writing-a-loader/" target="_blank" rel="noopener noreferrer">编写loader<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>编写 loader 时应该遵循以下准则</p><ul><li>简单易用: loaders 应该只做单一任务。这不仅使每个 loader 易维护，也可以在更多场景链式调用。</li><li>使用链式传递: 利用 loader 可以链式调用的优势。写五个简单的 loader 实现五项任务，而不是一个 loader 实现五项任务。</li><li>模块化的输出。保证输出模块化。loader 生成的模块与普通模块遵循相同的设计原则。</li><li>确保无状态。确保 <code>loader</code> 在不同模块转换之间不保存状态。每次运行都应该独立于其他编译模块以及相同模块之前的编译结果。</li></ul><p>loader 其实就是一个 function，接收一个参数 source，就是当前的文件内容，然后稍加处理，就可以 return 出一个新的文件内容。</p><p>example: 处理 .txt 文件，并且将任何实例中的 <code>[name]</code> 直接替换为 loader 选项中设置的 name。然后返回包含默认导出文本的 JavaScript 模块。</p><details class="custom-container details"><summary>点击查看代码</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;loader-utils&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\[name\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用</span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.txt$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../config/loader.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Alice&#39;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></details><p>异步调用</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 由于有 3 秒延迟，所以打包时需要 3+ 秒的时间</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>异步 <code>loader</code> 需要调用 webpack 的 <code>async()</code> 生成一个<code> callback</code>，它的第一个参数是 error，这里可设为 null，第二个参数就是处理后的源码。当你异步处理完源码后，调用 callback 即可。</p><h3 id="编写插件" tabindex="-1"><a class="header-anchor" href="#编写插件" aria-hidden="true">#</a> <a href="https://v4.webpack.docschina.org/contribute/writing-a-plugin/" target="_blank" rel="noopener noreferrer">编写插件<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>Compiler 和 Compilation</p><p>在插件开发中最重要的两个资源就是 compiler 和 compilation 对象。理解它们的角色是扩展 webpack 引擎重要的第一步。 compiler 对象代表了完整的 webpack 环境配置。这个对象在启动 webpack 时被一次性建立，并配置好所有可操作的设置，包括 options，loader 和 plugin。当在 webpack 环境中应用一个插件时，插件将收到此 compiler 对象的引用。可以使用它来访问 webpack 的主环境。 compilation 对象代表了一次资源版本构建。当运行 webpack 开发环境中间件时，每当检测到一个文件变化，就会创建一个新的 compilation，从而生成一组新的编译资源。一个 compilation 对象表现了当前的模块资源、编译生成资源、变化的文件、以及被跟踪依赖的状态信息。compilation 对象也提供了很多关键时机的回调，以供插件做自定义处理时选择使用。</p><p>一个插件由以下构成</p><ul><li>一个具名 JavaScript 函数。</li><li>在它的原型上定义 apply 方法。</li><li>指定一个触及到 webpack 本身的 事件钩子。</li><li>操作 webpack 内部的实例特定数据。</li><li>在实现功能后调用 webpack 提供的 callback。</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">FileListPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// emit 是异步 hook，使用 tapAsync 触及它，还可以使用 tapPromise/tap(同步)</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#39;FileListPlugin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 在生成文件中，创建一个头部字符串：</span>
      <span class="token keyword">var</span> filelist <span class="token operator">=</span> <span class="token string">&#39;In this build:\n\n&#39;</span><span class="token punctuation">;</span>

      <span class="token comment">// 遍历所有编译过的资源文件，</span>
      <span class="token comment">// 对于每个文件名称，都添加一行内容。</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> filename <span class="token keyword">in</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        filelist <span class="token operator">+=</span> <span class="token string">&#39;- &#39;</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">&#39;\n&#39;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 将这个列表作为一个新的文件资源，插入到 webpack 构建中：</span>
      compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span><span class="token string">&#39;filelist.md&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">source</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> filelist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">size</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> filelist<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FileListPlugin<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="tree-shaking" tabindex="-1"><a class="header-anchor" href="#tree-shaking" aria-hidden="true">#</a> <a href="https://webpack.docschina.org/guides/tree-shaking" target="_blank" rel="noopener noreferrer">Tree Shaking<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>Tree shaking 是一种通过清除多余代码方式来优化项目打包体积的技术，专业术语叫 Dead code elimination</p><p>必须使用 ES2015 模块语法。是基于esm 静态分析来的，而<code>require()</code>语法的 <code>CommonJS</code> 模块规范。这些模块是 <code>dynamic</code> 动态加载的，这意味着可以根据代码中的条件导入新模块。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myDynamicModule<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    myDynamicModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    myDynamicModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>CommonJS 模块的这种 dynamic 性质意味着无法应用 Tree Shaking，因为在实际运行代码之前无法确定需要哪些模块。</p><p>Tree Shaking: 顾名思义，把代码比作一棵树，把树上已经烂掉的果子比喻成不需要的代码，通过摇晃树的方式把烂掉的果子抖下来。</p><p>Tree Shaking 是 ES2015 模块定义中的一个功能。它的核心点在于，在不运行模块的情况下静态地分析模块，使得 Webpack 发现哪些部分的代码正在使用，而哪些代码没有被使用。</p><p>其实tree-shaking的消除原理是依赖于ES6的模块特性。</p><p>ES6 module 特点：</p><ol><li>只能作为模块顶层的语句出现</li><li>import 的模块名只能是字符串常量</li><li>import binding 是 immutable的</li></ol><p><strong>ES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析</strong>,</p><h3 id="webpack模块打包原理" tabindex="-1"><a class="header-anchor" href="#webpack模块打包原理" aria-hidden="true">#</a> <a href="https://juejin.cn/post/6844903802382860296" target="_blank" rel="noopener noreferrer">Webpack模块打包原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><ul><li><a href="https://zhuanlan.zhihu.com/p/243485307" target="_blank" rel="noopener noreferrer">模块加载<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> webpack根据<code>webpack.config.ts</code>中的入口文件，在入口文件里识别模块依赖，不管这里的模块依赖是用<code>CommonJS</code>写的，还是<code>ES6 Module</code>规范写的，webpack会自动进行分析，并通过转换、编译代码，打包成最终的文件。最终文件中的模块实现是基于webpack自己实现的<code>webpack_require</code>（es5代码），所以打包后的文件可以跑在浏览器上。</li></ul><p>使用一个立即执行函数，实现了类似Common Js require和exports的特性，核心是<code>__webpack_require__</code>的实现， 创建模块缓存<code>installedModules </code>，从入口文件执行require。</p><p>懒加载是动态创建jsonp的动态script标签，加载异步模块，加载完成<code>window[&quot;webpackJsonp&quot;]</code> push模块，异步模块打包后的文件中保存着异步模块源代码，同时为了区分不同的异步模块，还保存着该异步模块对应的标识：chunkId。</p><p>webpack实现模块的异步加载有点像jsonp的流程。在主js文件中通过在head中构建script标签方式，异步加载模块信息；再使用回调函数webpackJsonpCallback，把异步的模块源码同步到主文件中，所以后续操作异步模块可以像同步模块一样。</p><ol><li>到异步模块时，使用__webpack_require__.e函数去把异步代码加载进来。该函数会在html的head中动态增加script标签，src指向指定的异步模块存放的文件。</li><li>加载的异步模块文件会执行webpackJsonpCallback函数，把异步模块加载到主文件中。</li><li>所以后续可以像同步模块一样,直接使用__webpack_require__(&quot;./src/async.js&quot;)加载异步模块。</li></ol><p>源码中的<code>primose</code>使用非常精妙，主模块加载完成异步模块才resolve()</p><details class="custom-container details"><summary>点击查看代码</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 0.bundle.js</span>

<span class="token comment">// 异步模块</span>
<span class="token comment">// window[&quot;webpackJsonp&quot;]是连接多个chunk文件的桥梁</span>
<span class="token comment">// window[&quot;webpackJsonp&quot;].push = 主chunk文件.webpackJsonpCallback</span>
<span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 异步模块标识chunkId,可判断异步代码是否加载成功</span>
  <span class="token comment">// 跟同步模块一样，存放了{模块路径：模块内容}</span>
  <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;./src/async.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
      __webpack_exports__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&#39;hello, aysnc module&#39;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// webpack.config.ts</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// JavaScript 执行入口文件</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/main.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把所有依赖的模块合并输出到一个 bundle.js 文件</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;bundle.js&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// 输出文件都放到 dist 目录下</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/add</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;hello world,&#39;</span><span class="token punctuation">}</span> <span class="token comment">// 这里特意使用了ES6语法</span>
    <span class="token keyword">return</span> name <span class="token operator">+</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token comment">// src/main.js</span>
<span class="token keyword">import</span> Add <span class="token keyword">from</span> <span class="token string">&#39;./add&#39;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Add<span class="token punctuation">,</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>build.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// modules是存放所有模块的数组，数组中每个元素存储{ 模块路径: 模块导出代码函数 }</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 模块缓存作用，已加载的模块可以不用再重新读取，提升性能</span>
<span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 关键函数，加载模块代码</span>
<span class="token comment">// 形式有点像Node的CommonJS模块，但这里是可跑在浏览器上的es5代码</span>
<span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 缓存检查，有则直接从缓存中取得</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 先创建一个空模块，塞入缓存中</span>
  <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
    <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 标记是否已经加载</span>
    <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 初始模块为空</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 把要加载的模块内容，挂载到module.exports上</span>
  modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标记为已加载</span>

  <span class="token comment">// 返回加载的模块，调用方直接调用即可</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// __webpack_require__对象下的r函数</span>
<span class="token comment">// 在module.exports上定义__esModule为true，表明是一个模块对象</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&#39;__esModule&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 启动入口模块main.js</span>
<span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./src/main.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// add模块</span>
  <span class="token string-property property">&quot;./src/add.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在module.exports上定义__esModule为true</span>
    __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 直接把add模块内容，赋给module.exports.default对象上</span>
    __webpack_exports__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;hello world,&#39;</span><span class="token punctuation">}</span>
      <span class="token keyword">return</span> name <span class="token operator">+</span> a <span class="token operator">+</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// 入口模块</span>
  <span class="token string-property property">&quot;./src/main.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span>
    <span class="token comment">// 拿到add模块的定义</span>
    <span class="token comment">// _add__WEBPACK_IMPORTED_MODULE_0__ = module.exports，有点类似require</span>
    <span class="token keyword">var</span> _add__WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token string">&quot;./src/add.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// add模块内容: _add__WEBPACK_IMPORTED_MODULE_0__[&quot;default&quot;]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_add__WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">Object</span><span class="token punctuation">(</span>_add__WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div></details><h3 id="require-context是什么" tabindex="-1"><a class="header-anchor" href="#require-context是什么" aria-hidden="true">#</a> require.context是什么</h3><p>一个webpack的api，通过执行<code>require.context</code>函数获取一个特定的上下文，主要用来实现自动化导入模块，在前端工程中，如果遇到从一个文件夹引入很多模块的情况， 可以使用这个api，它会遍历文件夹中的指定文件，然后自动导入，使得不需要每次显式的调用<code>import</code>导入模块。比如在Vue中使用<code>require.context</code>函数遍历modules文件夹的所有文件一次性导入到index.js中</p><blockquote><p>语法: <code>require.context(directory, useSubdirectories = false, regExp = /^.//);</code> require.context函数接受三个参数</p></blockquote><ol><li><p>directory {String} -读取文件的路径</p></li><li><p>useSubdirectories {Boolean} -是否遍历文件的子目录</p></li><li><p>regExp {RegExp} -匹配文件的正则</p></li></ol><h3 id="sourcemap" tabindex="-1"><a class="header-anchor" href="#sourcemap" aria-hidden="true">#</a> <a href="https://mp.weixin.qq.com/s/87VqGBaT9aF1B1Tokr4CKQ" target="_blank" rel="noopener noreferrer">SourceMap<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>sourceMap可以帮我们直接定位到编译前代码的特定位置。</p><p>sourceMap其实就是就是一段维护了前后代码映射关系的json描述文件，包含了以下一些信息：</p><ul><li>version：sourcemap版本（现在都是v3）</li><li>file：转换后的文件名。</li><li>sourceRoot：转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空。</li><li>sources：转换前的文件。该项是一个数组，表示可能存在多个文件合并。</li><li>names：转换前的所有变量名和属性名。</li><li>mappings：记录位置信息的字符串。mappings 信息是关键，它使用Base64 VLQ 编码，包含了源代码与生成代码的位置映射信息。</li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/qinsong77/qinsong77.github.io/edit/main/fe/webpack/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: xyqinsong@163.com">notend</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: qinsong1@cmiot.chinamobile.com">qinsong</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: xyqinsong@163.com">qinsong77</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: qinsong01@huohua.cn">qinsong01</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.552fc8bd.js" defer></script>
  </body>
</html>
